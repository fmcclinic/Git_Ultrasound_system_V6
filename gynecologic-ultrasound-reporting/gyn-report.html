<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gynecologic Ultrasound Report / Báo cáo Siêu âm Phụ khoa</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Gynecologic Ultrasound Reporting System / Hệ thống tạo báo cáo Siêu âm Phụ khoa</h1>

        <div class="tab-container">
            <div class="tab-nav">
                <button class="tab-button active" data-tab="patient-info">Patient Info / Thông tin BN</button>
                <button class="tab-button" data-tab="gyn-assessment">Gynecologic Assessment / Khảo sát Phụ khoa</button>
                <button class="tab-button" data-tab="images">Images / Hình ảnh</button>
                <button class="tab-button" data-tab="templates">Templates / Mẫu</button>
                <button class="tab-button" data-tab="report">Report / Báo cáo</button>
            </div>

            <div class="tab-content active" id="patient-info">
                 <h2>Patient Information / Thông tin Bệnh nhân</h2>
                 <form id="patient-info-form">
                    <div class="form-group">
                        <label for="patient-name">Họ và Tên / Full Name:</label>
                        <input type="text" id="patient-name" name="patientName" required>
                    </div>
                    <div class="form-group">
                        <label for="patient-id">Mã BN / Patient ID:</label>
                        <input type="text" id="patient-id" name="patientId" required>
                    </div>
                     <div class="form-group">
                        <label for="patient-dob">Ngày sinh / Date of Birth:</label>
                        <input type="date" id="patient-dob" name="patientDob">
                    </div>
                    <div class="form-group">
                        <label for="requesting-physician">Bác sĩ chỉ định / Requesting Physician:</label>
                        <input type="text" id="requesting-physician" name="requestingPhysician">
                    </div>
                    <div class="form-group">
                        <label for="exam-date">Ngày siêu âm / Exam Date:</label>
                        <input type="date" id="exam-date" name="examDate" value=""> </div>
                    <div class="form-group">
                        <label for="reason">Reason for Exam / Clinical Info / Lý do khám / LS:</label>
                        <input type="text" id="reason" name="reason" list="reason-suggestions-gyn" placeholder="Enter reason or select from list... / Nhập lý do hoặc chọn từ danh sách...">
                        <datalist id="reason-suggestions-gyn">
                            <option value="Pelvic pain / Đau bụng dưới"></option>
                            <option value="Abnormal uterine bleeding / Ra huyết tử cung bất thường"></option>
                            <option value="Rule out mass / Tìm khối u"></option>
                            <option value="Infertility workup / Khảo sát hiếm muộn"></option>
                            <option value="Follicular monitoring / Theo dõi nang noãn"></option>
                            <option value="Postmenopausal bleeding / Ra huyết sau mãn kinh"></option>
                            <option value="Amenorrhea / Vô kinh"></option>
                            <option value="IUD localization / Kiểm tra vị trí vòng"></option>
                            <option value="Screening / Tầm soát"></option>
                            <option value="Suspected PCOS / Nghi ngờ Đa nang buồng trứng"></option>
                            <option value="Follow-up cyst/mass / Theo dõi nang/khối u"></option>
                            <option value="Assess endometrium / Đánh giá nội mạc tử cung"></option>
                        </datalist>
                    </div>
                     <div class="form-group">
                        <label for="reporting-doctor">Reporting Doctor / Bác sĩ siêu âm:</label>
                        <input type="text" id="reporting-doctor" name="reportingDoctor" placeholder="Enter reporting doctor's name / Nhập tên BS đọc KQ">
                    </div>
                </form>
            </div>

            <div class="tab-content" id="gyn-assessment">
                <h2>Gynecologic Assessment / Khảo sát Phụ khoa</h2>
                <form id="gyn-assessment-form">

                    <div class="form-group short-input-group">
                        <label for="scan-approach">Scan Approach / Ngã tiếp cận:</label>
                        <select id="scan-approach" name="scanApproach">
                            <option value="Transabdominal / Ngã bụng">Transabdominal / Ngã bụng</option>
                            <option value="Transvaginal / Ngã âm đạo" selected>Transvaginal / Ngã âm đạo</option>
                            <option value="Combined / Kết hợp">Combined / Kết hợp</option>
                        </select>
                    </div>
                    <hr style="margin: 15px 0;">

                    <details class="section organ-section" open>
                        <summary class="section-toggle"><h3><i class="fas fa-female"></i> Uterus / Tử cung</h3></summary>
                        <div class="section-content">
                            <div class="form-grid-col-3">
                                <div class="form-group">
                                    <label for="uterus-position">Position / Tư thế:</label>
                                    <select id="uterus-position" name="uterusPosition">
                                        <option value="">-- Select / Chọn --</option>
                                        <option value="Anteverted / Ngã trước">Anteverted / Ngã trước</option>
                                        <option value="Anteverted-anteflexed / Ngã trước - Gập trước">AV-AF / Ngã trước-Gập trước</option>
                                        <option value="Retroverted / Ngã sau">Retroverted / Ngã sau</option>
                                        <option value="Retroverted-retroflexed / Ngã sau - Gập sau">RV-RF / Ngã sau-Gập sau</option>
                                        <option value="Midline / Trung gian">Midline / Trung gian</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="uterus-size-l">Size L (mm) / Kích thước Dài:</label>
                                    <input type="number" step="1" id="uterus-size-l" name="uterusSizeL" placeholder="mm">
                                </div>
                                <div class="form-group">
                                    <label for="uterus-size-w">Size W (mm) / Kích thước Rộng:</label>
                                    <input type="number" step="1" id="uterus-size-w" name="uterusSizeW" placeholder="mm">
                                </div>
                                <div class="form-group">
                                    <label for="uterus-size-ap">Size AP (mm) / Kích thước Trước-sau:</label>
                                    <input type="number" step="1" id="uterus-size-ap" name="uterusSizeAP" placeholder="mm">
                                </div>
                                <div class="form-group">
                                    <label for="uterus-shape">Shape / Hình dạng:</label>
                                    <select id="uterus-shape" name="uterusShape">
                                        <option value="Normal / Bình thường">Normal / Bình thường</option>
                                        <option value="Arcuate / Hình cung">Arcuate / Hình cung</option>
                                        <option value="Septate / Có vách ngăn">Septate / Có vách ngăn</option>
                                        <option value="Bicornuate / Hai sừng">Bicornuate / Hai sừng</option>
                                        <option value="Didelphys / Tử cung đôi">Didelphys / Tử cung đôi</option>
                                        <option value="Infantile / Dạng trẻ em">Infantile / Dạng trẻ em</option>
                                        <option value="Bulky / To">Bulky / To</option>
                                        <option value="Irregular / Không đều">Irregular / Không đều</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="uterus-contour">Contour / Đường bờ:</label>
                                    <select id="uterus-contour" name="uterusContour">
                                        <option value="Smooth / Trơn láng">Smooth / Trơn láng</option>
                                        <option value="Irregular / Không đều">Irregular / Không đều</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="uterus-myometrium">Myometrium / Cơ tử cung:</label>
                                <select id="uterus-myometrium" name="uterusMyometrium">
                                    <option value="Homogeneous / Đồng nhất">Homogeneous / Đồng nhất</option>
                                    <option value="Heterogeneous / Không đồng nhất">Heterogeneous / Không đồng nhất</option>
                                    <option value="Fibroids Present / Có U xơ">Fibroids Present / Có U xơ</option>
                                    <option value="Adenomyosis Suspected / Nghi ngờ Lạc tuyến trong cơ">Adenomyosis Suspected / Nghi ngờ Lạc tuyến trong cơ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                 <label for="uterus-comments">Uterus Comments / Ghi chú Tử cung:</label>
                                 <textarea id="uterus-comments" name="uterusComments" rows="2" placeholder="Additional comments about uterus (e.g., presence of Nabothian cysts, C-section scar evaluation)... / Ghi chú thêm về tử cung (vd: nang Nabothian, đánh giá sẹo mổ cũ)..."></textarea>
                                 <div class="suggestion-button-container">
                                     <button type="button" class="suggestion-btn" data-insert="Nabothian cysts noted. / Ghi nhận nang Nabothian.">Nabothian Cysts</button>
                                     <button type="button" class="suggestion-btn" data-insert="C-section scar evaluated, appears intact. Myometrial thickness at scar [X] mm. / Đánh giá sẹo mổ cũ, có vẻ nguyên vẹn. Bề dày cơ tại sẹo [X] mm.">C-section Scar OK</button>
                                     <button type="button" class="suggestion-btn" data-insert="C-section scar defect noted ([size] mm). / Ghi nhận khuyết sẹo mổ cũ ([kích thước] mm).">C-section Scar Defect</button>
                                      <button type="button" class="suggestion-btn" data-insert="Diffuse adenomyosis suspected. / Nghi ngờ lạc tuyến trong cơ tử cung lan tỏa.">Diffuse Adenomyosis</button>
                                      <button type="button" class="suggestion-btn" data-insert="Focal adenomyosis suspected in [location]. / Nghi ngờ lạc tuyến trong cơ tử cung khu trú ở [vị trí].">Focal Adenomyosis</button>
                                </div>
                            </div>

                            <div id="fibroids-section" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ccc;">
                                <h4><i class="fas fa-circle"></i> Fibroids Details / Chi tiết U xơ</h4>
                                <div id="fibroids-list">
                                    </div>
                                <button type="button" id="add-fibroid-btn" class="small-btn"><i class="fas fa-plus"></i> Add Fibroid / Thêm U xơ</button>
                            </div>

                            <template id="fibroid-template">
                                <div class="dynamic-entry fibroid-entry" data-fibroid-id="">
                                    <div class="form-grid-col-3">
                                        <div class="form-group">
                                            <label>Location / Vị trí:</label>
                                            <select name="fibroidLocation">
                                                <option value="">-- Select / Chọn --</option>
                                                <option value="Anterior / Mặt trước">Anterior / Mặt trước</option>
                                                <option value="Posterior / Mặt sau">Posterior / Mặt sau</option>
                                                <option value="Fundal / Đáy">Fundal / Đáy</option>
                                                <option value="Intramural / Trong cơ">Intramural / Trong cơ</option>
                                                <option value="Subserosal / Dưới thanh mạc">Subserosal / Dưới thanh mạc</option>
                                                <option value="Submucosal / Dưới niêm mạc">Submucosal / Dưới niêm mạc</option>
                                                <option value="Cervical / Cổ tử cung">Cervical / Cổ tử cung</option>
                                                <option value="Pedunculated Subserosal / Dưới TM có cuống">Pedunculated Subserosal</option>
                                                <option value="Pedunculated Submucosal / Dưới NM có cuống">Pedunculated Submucosal</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Size (mm) / Kích thước:</label>
                                            <input type="text" name="fibroidSize" placeholder="e.g., 25x20x18 mm / ví dụ: 25x20x18 mm">
                                        </div>
                                        <div class="form-group">
                                            <label>Echogenicity / Độ hồi âm:</label>
                                            <select name="fibroidEchogenicity">
                                                <option value="Hypoechoic / Kém">Hypoechoic / Kém</option>
                                                <option value="Isoechoic / Đồng nhất">Isoechoic / Đồng nhất</option>
                                                <option value="Hyperechoic / Dày">Hyperechoic / Dày</option>
                                                <option value="Mixed / Hỗn hợp">Mixed / Hỗn hợp</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Description / Mô tả:</label>
                                        <textarea name="fibroidDescription" rows="2" placeholder="Describe calcifications, degeneration, shadowing..."></textarea>
                                        <div class="suggestion-button-container">
                                            <button type="button" class="suggestion-btn" data-insert="Calcified / Vôi hóa">Calcified</button>
                                            <button type="button" class="suggestion-btn" data-insert="Cystic degeneration / Thoái hóa nang">Cystic Degeneration</button>
                                            <button type="button" class="suggestion-btn" data-insert="Shadowing noted / Có bóng lưng">Shadowing</button>
                                            <button type="button" class="suggestion-btn" data-insert="Well-defined / Giới hạn rõ">Well-defined</button>
                                            <button type="button" class="suggestion-btn" data-insert="Indents endometrium / Đè đẩy nội mạc">Indents Endometrium</button>
                                             <button type="button" class="suggestion-btn" data-insert="No significant internal vascularity. / Không tăng sinh mạch máu đáng kể bên trong.">No Vascularity</button>
                                            <button type="button" class="suggestion-btn" data-insert="Peripheral vascularity noted. / Ghi nhận tăng sinh mạch máu ngoại vi.">Peripheral Vascularity</button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Comments / Ghi chú:</label>
                                        <input type="text" name="fibroidComments" placeholder="Optional comments / Ghi chú thêm">
                                    </div>
                                    <button type="button" class="remove-btn danger-btn"><i class="fas fa-times"></i> Remove / Xóa</button>
                                </div>
                            </template>
                        </div>
                    </details>

                    <details class="section organ-section">
                        <summary class="section-toggle"><h3><i class="fas fa-layer-group"></i> Endometrium / Nội mạc tử cung</h3></summary>
                        <div class="section-content">
                            <div class="form-grid-col-3">
                                <div class="form-group">
                                    <label for="endometrium-thickness">Thickness (mm) / Bề dày:</label>
                                    <input type="number" step="0.1" id="endometrium-thickness" name="endometriumThickness" placeholder="mm (Double layer / 2 lá)">
                                </div>
                                <div class="form-group">
                                    <label for="endometrium-echogenicity">Echogenicity / Độ hồi âm:</label>
                                    <select id="endometrium-echogenicity" name="endometriumEchogenicity">
                                        <option value="Homogeneous / Đồng nhất">Homogeneous / Đồng nhất</option>
                                        <option value="Heterogeneous / Không đồng nhất">Heterogeneous / Không đồng nhất</option>
                                        <option value="Isoechoic to myometrium / Đồng hồi âm với cơ TC">Isoechoic to myometrium</option>
                                        <option value="Hyperechoic / Dày">Hyperechoic / Dày</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="iud-status">IUD Status / Tình trạng Vòng:</label>
                                    <select id="iud-status" name="iudStatus">
                                        <option value="Not Present / Không có">Not Present / Không có</option>
                                        <option value="Present, Normal Position / Có, Vị trí đúng">Present, Normal Position / Có, Vị trí đúng</option>
                                        <option value="Present, Low Position / Có, Vị trí thấp">Present, Low Position / Có, Vị trí thấp</option>
                                        <option value="Present, Embedded / Có, Lạc chỗ trong cơ">Present, Embedded / Có, Lạc chỗ trong cơ</option>
                                         <option value="Present, Type Unclear / Có, Không rõ loại">Present, Type Unclear / Có, Không rõ loại</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="endometrium-appearance">Appearance/Pattern / Hình thái/Dạng:</label>
                                <textarea id="endometrium-appearance" name="endometriumAppearance" rows="3" placeholder="Describe pattern (trilaminar, homogeneous), fluid, polyp suspicion..."></textarea>
                                <div class="suggestion-button-container">
                                    <button type="button" class="suggestion-btn" data-insert="Trilaminar pattern / Dạng 3 lá">Trilaminar</button>
                                    <button type="button" class="suggestion-btn" data-insert="Homogeneous pattern / Dạng đồng nhất">Homogeneous</button>
                                    <button type="button" class="suggestion-btn" data-insert="Thin, echogenic (postmenopausal/atrophic) / Mỏng, echo dày (sau mãn kinh/teo)">Thin/Atrophic</button>
                                    <button type="button" class="suggestion-btn" data-insert="Fluid collection within cavity ([measurement] mm) / Tụ dịch trong lòng ([số đo] mm)">Fluid Collection</button>
                                    <button type="button" class="suggestion-btn" data-insert="Cystic changes noted / Ghi nhận thay đổi dạng nang">Cystic Changes</button>
                                    <button type="button" class="suggestion-btn" data-insert="Suspected polyp / Nghi ngờ polyp ([size] mm)">Suspected Polyp</button>
                                    <button type="button" class="suggestion-btn" data-insert="Irregular endometrial-myometrial junction / Đường nối nội mạc - cơ TC không đều">Irregular Junction</button>
                                    <button type="button" class="suggestion-btn" data-insert="Thickened and heterogeneous. Recommend correlation/biopsy. / Dày và không đồng nhất. Đề nghị đối chiếu/sinh thiết.">Thick/Heterogeneous</button>
                                    <button type="button" class="suggestion-btn" data-insert="Indistinct / Không rõ ràng">Indistinct</button>
                                </div>
                            </div>
                        </div>
                    </details>

                    <details class="section organ-section">
                        <summary class="section-toggle"><h3><i class="fas fa-vial"></i> Cervix / Cổ tử cung</h3></summary>
                        <div class="section-content">
                             <div class="form-group">
                                <label for="cervix-appearance">Appearance / Hình dạng:</label>
                                <textarea id="cervix-appearance" name="cervixAppearance" rows="2" placeholder="Describe cervix appearance (normal, cysts, polyp, mass)..."></textarea>
                                <div class="suggestion-button-container">
                                     <button type="button" class="suggestion-btn" data-insert="Normal appearance / Hình dạng bình thường.">Normal</button>
                                     <button type="button" class="suggestion-btn" data-insert="Nabothian cysts noted. / Ghi nhận nang Nabothian.">Nabothian Cysts</button>
                                     <button type="button" class="suggestion-btn" data-insert="Suspected cervical polyp / Nghi ngờ polyp cổ tử cung ([size] mm).">Suspected Polyp</button>
                                     <button type="button" class="suggestion-btn" data-insert="Cervical mass noted / Ghi nhận khối u cổ tử cung ([size] mm). Further evaluation recommended. / Đề nghị đánh giá thêm.">Cervical Mass</button>
                                      <button type="button" class="suggestion-btn" data-insert="Not well visualized / Không thấy rõ.">Not Visualized</button>
                                </div>
                            </div>
                             <div class="form-group short-input-group">
                                <label for="cervix-length">Length (mm) / Chiều dài (if relevant / nếu cần):</label>
                                <input type="number" step="0.1" id="cervix-length" name="cervixLength" placeholder="mm (e.g., post-treatment)">
                            </div>
                        </div>
                    </details>

                    <details class="section organ-section">
                        <summary class="section-toggle"><h3><i class="fas fa-object-group"></i> Adnexa / Phần phụ (Ovaries / Buồng trứng)</h3></summary>
                        <div class="section-content">
                            <div class="form-grid-col-2">
                                <fieldset class="sub-section ovary-section">
                                    <legend>Right Ovary / Buồng trứng Phải</legend>
                                    <div class="form-group">
                                        <label for="ovary-right-visibility">Visibility / Khả năng thấy:</label>
                                        <select id="ovary-right-visibility" name="ovaryRightVisibility">
                                            <option value="Visualized / Thấy rõ">Visualized / Thấy rõ</option>
                                            <option value="Partially Visualized / Thấy một phần">Partially Visualized / Thấy một phần</option>
                                            <option value="Obscured by bowel gas / Bị che bởi hơi ruột">Obscured by bowel gas / Bị che bởi hơi ruột</option>
                                            <option value="Not Visualized / Không thấy">Not Visualized / Không thấy</option>
                                             <option value="Surgically Absent / Đã cắt bỏ">Surgically Absent / Đã cắt bỏ</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Size (L x W x AP in mm) / Kích thước (D x R x TS):</label>
                                        <div class="dimension-input-row">
                                            <input type="number" step="1" id="ovary-right-size-l" name="ovaryRightSizeL" placeholder="L">
                                            <span>x</span>
                                            <input type="number" step="1" id="ovary-right-size-w" name="ovaryRightSizeW" placeholder="W">
                                            <span>x</span>
                                            <input type="number" step="1" id="ovary-right-size-ap" name="ovaryRightSizeAP" placeholder="AP">
                                            <span>mm</span>
                                        </div>
                                    </div>
                                     <div class="form-group">
                                        <label for="ovary-right-volume">Volume (mL) / Thể tích:</label>
                                        <input type="number" step="0.1" id="ovary-right-volume" name="ovaryRightVolume" placeholder="mL" class="calculated-value" readonly> </div>
                                    <div class="form-group">
                                        <label for="ovary-right-appearance">Appearance / Hình thái:</label>
                                        <textarea id="ovary-right-appearance" name="ovaryRightAppearance" rows="3" placeholder="Describe follicles, PCO-like, quiescent, mass..."></textarea>
                                        <div class="suggestion-button-container">
                                            <button type="button" class="suggestion-btn" data-insert="Normal appearance with follicles. / Hình thái bình thường với các nang noãn.">Normal Follicles</button>
                                            <button type="button" class="suggestion-btn" data-insert="[Number] antral follicles seen, largest [size] mm. / Thấy [Số lượng] nang thứ cấp, nang lớn nhất [kích thước] mm.">Antral Follicles</button>
                                            <button type="button" class="suggestion-btn" data-insert="Dominant follicle measuring [size] mm. / Nang trội kích thước [kích thước] mm.">Dominant Follicle</button>
                                            <button type="button" class="suggestion-btn" data-insert="PCO-like morphology (>20 follicles, increased volume). / Hình thái dạng đa nang (>20 nang, thể tích tăng).">PCO Morphology</button>
                                            <button type="button" class="suggestion-btn" data-insert="Quiescent / Atrophic appearance. / Hình thái im lặng / teo nhỏ.">Quiescent/Atrophic</button>
                                            <button type="button" class="suggestion-btn" data-insert="Contains cyst/mass (describe below). / Chứa nang/khối u (mô tả bên dưới).">Contains Cyst/Mass</button>
                                            <button type="button" class="suggestion-btn" data-insert="Normal Doppler flow. / Phổ Doppler bình thường.">Normal Doppler</button>
                                        </div>
                                    </div>
                                </fieldset>

                                <fieldset class="sub-section ovary-section">
                                    <legend>Left Ovary / Buồng trứng Trái</legend>
                                     <div class="form-group">
                                        <label for="ovary-left-visibility">Visibility / Khả năng thấy:</label>
                                        <select id="ovary-left-visibility" name="ovaryLeftVisibility">
                                            <option value="Visualized / Thấy rõ">Visualized / Thấy rõ</option>
                                            <option value="Partially Visualized / Thấy một phần">Partially Visualized / Thấy một phần</option>
                                            <option value="Obscured by bowel gas / Bị che bởi hơi ruột">Obscured by bowel gas / Bị che bởi hơi ruột</option>
                                            <option value="Not Visualized / Không thấy">Not Visualized / Không thấy</option>
                                             <option value="Surgically Absent / Đã cắt bỏ">Surgically Absent / Đã cắt bỏ</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Size (L x W x AP in mm) / Kích thước (D x R x TS):</label>
                                        <div class="dimension-input-row">
                                            <input type="number" step="1" id="ovary-left-size-l" name="ovaryLeftSizeL" placeholder="L">
                                            <span>x</span>
                                            <input type="number" step="1" id="ovary-left-size-w" name="ovaryLeftSizeW" placeholder="W">
                                            <span>x</span>
                                            <input type="number" step="1" id="ovary-left-size-ap" name="ovaryLeftSizeAP" placeholder="AP">
                                            <span>mm</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="ovary-left-volume">Volume (mL) / Thể tích:</label>
                                        <input type="number" step="0.1" id="ovary-left-volume" name="ovaryLeftVolume" placeholder="mL" class="calculated-value" readonly> </div>
                                    <div class="form-group">
                                        <label for="ovary-left-appearance">Appearance / Hình thái:</label>
                                        <textarea id="ovary-left-appearance" name="ovaryLeftAppearance" rows="3" placeholder="Describe follicles, PCO-like, quiescent, mass..."></textarea>
                                         <div class="suggestion-button-container">
                                            <button type="button" class="suggestion-btn" data-insert="Normal appearance with follicles. / Hình thái bình thường với các nang noãn.">Normal Follicles</button>
                                            <button type="button" class="suggestion-btn" data-insert="[Number] antral follicles seen, largest [size] mm. / Thấy [Số lượng] nang thứ cấp, nang lớn nhất [kích thước] mm.">Antral Follicles</button>
                                            <button type="button" class="suggestion-btn" data-insert="Dominant follicle measuring [size] mm. / Nang trội kích thước [kích thước] mm.">Dominant Follicle</button>
                                            <button type="button" class="suggestion-btn" data-insert="PCO-like morphology (>20 follicles, increased volume). / Hình thái dạng đa nang (>20 nang, thể tích tăng).">PCO Morphology</button>
                                            <button type="button" class="suggestion-btn" data-insert="Quiescent / Atrophic appearance. / Hình thái im lặng / teo nhỏ.">Quiescent/Atrophic</button>
                                            <button type="button" class="suggestion-btn" data-insert="Contains cyst/mass (describe below). / Chứa nang/khối u (mô tả bên dưới).">Contains Cyst/Mass</button>
                                            <button type="button" class="suggestion-btn" data-insert="Normal Doppler flow. / Phổ Doppler bình thường.">Normal Doppler</button>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>

                             <div class="form-group">
                                 <label for="adnexa-comments">Adnexa Comments / Ghi chú Phần phụ:</label>
                                 <textarea id="adnexa-comments" name="adnexaComments" rows="2" placeholder="Additional comments about adnexa (e.g., hydrosalpinx, paraovarian cyst)... / Ghi chú thêm về phần phụ (vd: ứ dịch vòi trứng, nang cạnh buồng trứng)..."></textarea>
                                 <div class="suggestion-button-container">
                                     <button type="button" class="suggestion-btn" data-insert="No adnexal mass identified. / Không thấy khối u phần phụ.">No Mass</button>
                                      <button type="button" class="suggestion-btn" data-insert="Hydrosalpinx noted on the [right/left] side, measuring [size] mm. / Ghi nhận ứ dịch vòi trứng bên [phải/trái], kích thước [số đo] mm.">Hydrosalpinx</button>
                                      <button type="button" class="suggestion-btn" data-insert="Paraovarian cyst noted on the [right/left] side, measuring [size] mm. / Ghi nhận nang cạnh buồng trứng bên [phải/trái], kích thước [số đo] mm.">Paraovarian Cyst</button>
                                      <button type="button" class="suggestion-btn" data-insert="No free fluid in the adnexa. / Không có dịch tự do ở phần phụ.">No Adnexal Fluid</button>
                                </div>
                            </div>

                            <div id="adnexal-findings-section" style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ccc;">
                                <h4><i class="fas fa-search-plus"></i> Adnexal Findings (Masses/Cysts) / Tổn thương Phần phụ (Khối u/Nang)</h4>
                                <div id="adnexal-findings-list">
                                    </div>
                                <button type="button" id="add-adnexal-finding-btn" class="small-btn"><i class="fas fa-plus"></i> Add Finding / Thêm Tổn thương</button>
                            </div>

                            <template id="adnexal-finding-template">
                                <div class="dynamic-entry adnexal-finding-entry" data-finding-id="">
                                    <div class="form-grid-col-3">
                                        <div class="form-group">
                                            <label>Laterality / Bên:</label>
                                            <select name="findingLaterality">
                                                <option value="Right / Phải">Right / Phải</option>
                                                <option value="Left / Trái">Left / Trái</option>
                                                <option value="Bilateral / Hai bên">Bilateral / Hai bên</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Origin (Suspected) / Nguồn gốc (Nghi ngờ):</label>
                                            <select name="findingOrigin">
                                                <option value="Ovarian / Buồng trứng">Ovarian / Buồng trứng</option>
                                                <option value="Paraovarian / Cạnh buồng trứng">Paraovarian / Cạnh buồng trứng</option>
                                                <option value="Tubal / Vòi trứng">Tubal / Vòi trứng</option>
                                                <option value="Uterine / Tử cung">Uterine / Tử cung</option>
                                                <option value="Other/Unclear / Khác/Không rõ">Other/Unclear / Khác/Không rõ</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Size (mm) / Kích thước:</label>
                                            <input type="text" name="findingSize" placeholder="e.g., 45x40x38 mm / ví dụ: 45x40x38 mm">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Type / Loại tổn thương:</label>
                                        <select name="findingType">
                                            <option value="Simple Cyst / Nang đơn giản">Simple Cyst / Nang đơn giản</option>
                                            <option value="Hemorrhagic Cyst / Nang xuất huyết">Hemorrhagic Cyst / Nang xuất huyết</option>
                                            <option value="Endometrioma / Nang lạc nội mạc">Endometrioma / Nang lạc nội mạc</option>
                                            <option value="Dermoid Cyst / Nang bì">Dermoid Cyst / Nang bì</option>
                                            <option value="Complex Cyst (Solid/Cystic) / Nang phức tạp (Đặc/Nang)">Complex Cyst (Solid/Cystic) / Nang phức tạp (Đặc/Nang)</option>
                                            <option value="Solid Mass / Khối đặc">Solid Mass / Khối đặc</option>
                                            <option value="Hydrosalpinx / Ứ dịch vòi trứng">Hydrosalpinx / Ứ dịch vòi trứng</option>
                                            <option value="Other / Khác">Other / Khác</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Description / Mô tả chi tiết:</label>
                                        <textarea name="findingDescription" rows="4" placeholder="Describe wall, septations, papillary projections, internal echogenicity, acoustic features, Doppler score..."></textarea>
                                        <div class="suggestion-button-container">
                                            <button type="button" class="suggestion-btn" data-insert="Thin smooth wall. / Vách mỏng trơn láng.">Wall: Thin Smooth</button>
                                            <button type="button" class="suggestion-btn" data-insert="Thickened wall. / Vách dày.">Wall: Thickened</button>
                                            <button type="button" class="suggestion-btn" data-insert="Irregular wall. / Vách không đều.">Wall: Irregular</button>
                                            <button type="button" class="suggestion-btn" data-insert="No septations. / Không vách ngăn.">Septations: None</button>
                                            <button type="button" class="suggestion-btn" data-insert="Thin septations (<3mm). / Vách ngăn mỏng (<3mm).">Septations: Thin</button>
                                            <button type="button" class="suggestion-btn" data-insert="Thick septations (>=3mm). / Vách ngăn dày (>=3mm).">Septations: Thick</button>
                                            <button type="button" class="suggestion-btn" data-insert="No papillary projections. / Không chồi.">Papillations: No</button>
                                            <button type="button" class="suggestion-btn" data-insert="Papillary projections present. / Có chồi.">Papillations: Yes</button>
                                            <button type="button" class="suggestion-btn" data-insert="Anechoic content. / Nội dung trống âm.">Echo: Anechoic</button>
                                            <button type="button" class="suggestion-btn" data-insert="Low-level internal echoes (hemorrhagic/proteinaceous). / Hồi âm bên trong mức độ thấp (xuất huyết/giàu protein).">Echo: Low-level</button>
                                            <button type="button" class="suggestion-btn" data-insert="Ground glass appearance (endometrioma). / Dạng kính mờ (nang lạc nội mạc).">Echo: Ground Glass</button>
                                            <button type="button" class="suggestion-btn" data-insert="Mixed cystic and solid components. / Thành phần hỗn hợp nang và đặc.">Echo: Mixed Solid/Cystic</button>
                                            <button type="button" class="suggestion-btn" data-insert="Echogenic foci (dermoid). / Nốt hồi âm dày (nang bì).">Echo: Echogenic Foci</button>
                                            <button type="button" class="suggestion-btn" data-insert="Reticular pattern (hemorrhagic cyst). / Dạng lưới (nang xuất huyết).">Echo: Reticular</button>
                                             <button type="button" class="suggestion-btn" data-insert="Predominantly solid. / Chủ yếu là đặc.">Echo: Solid</button>
                                            <button type="button" class="suggestion-btn" data-insert="Posterior acoustic enhancement. / Tăng âm phía sau.">Acoustic: Enhancement</button>
                                            <button type="button" class="suggestion-btn" data-insert="Posterior acoustic shadowing. / Bóng lưng phía sau.">Acoustic: Shadowing</button>
                                            <button type="button" class="suggestion-btn" data-insert="Color Doppler Score 1 (No flow). / Điểm Doppler màu 1 (Không có dòng chảy).">Doppler: Score 1</button>
                                            <button type="button" class="suggestion-btn" data-insert="Color Doppler Score 2 (Minimal flow). / Điểm Doppler màu 2 (Dòng chảy tối thiểu).">Doppler: Score 2</button>
                                            <button type="button" class="suggestion-btn" data-insert="Color Doppler Score 3 (Moderate flow). / Điểm Doppler màu 3 (Dòng chảy vừa phải).">Doppler: Score 3</button>
                                            <button type="button" class="suggestion-btn" data-insert="Color Doppler Score 4 (Marked flow). / Điểm Doppler màu 4 (Dòng chảy nhiều).">Doppler: Score 4</button>
                                             <button type="button" class="suggestion-btn" data-insert="Flow detected in septations/solid components. / Phát hiện dòng chảy trong vách ngăn/thành phần đặc.">Doppler: Flow Detected</button>
                                        </div>
                                    </div>
                                    <button type="button" class="remove-btn danger-btn"><i class="fas fa-times"></i> Remove / Xóa</button>
                                </div>
                            </template>

                        </div>
                    </details>

                    <details class="section organ-section">
                        <summary class="section-toggle"><h3><i class="fas fa-tint"></i> Cul-de-sac / Túi cùng Douglas</h3></summary>
                        <div class="section-content">
                            <div class="form-group">
                                <label for="culdesac-fluid">Free Fluid / Dịch tự do:</label>
                                <textarea id="culdesac-fluid" name="culdesacFluid" rows="2" placeholder="Describe free fluid amount and characteristics..."></textarea>
                                <div class="suggestion-button-container">
                                    <button type="button" class="suggestion-btn" data-insert="None / Không có.">None</button>
                                    <button type="button" class="suggestion-btn" data-insert="Physiologic amount / Lượng sinh lý.">Physiologic</button>
                                    <button type="button" class="suggestion-btn" data-insert="Small amount / Lượng ít.">Small</button>
                                    <button type="button" class="suggestion-btn" data-insert="Moderate amount / Lượng vừa.">Moderate</button>
                                    <button type="button" class="suggestion-btn" data-insert="Large amount / Lượng nhiều.">Large</button>
                                    <button type="button" class="suggestion-btn" data-insert="Complex / Echogenic fluid (suggestive of blood/pus). / Dịch phức tạp / có hồi âm (gợi ý máu/mủ).">Complex/Echogenic</button>
                                </div>
                            </div>
                        </div>
                    </details>

                    <details class="section organ-section" open>
                        <summary class="section-toggle"><h3><i class="fas fa-file-medical-alt"></i> Impression & Recommendation / Kết luận & Đề nghị</h3></summary>
                         <div class="section-content">
                            <div class="form-group">
                                <label for="impression">Impression / Kết luận:</label>
                                <textarea id="impression" name="impression" rows="5" placeholder="Summarize key findings for GYN Ultrasound... / Tóm tắt các kết quả chính của siêu âm phụ khoa..."></textarea>
                                <div class="suggestion-button-container">
                                    <button type="button" class="suggestion-btn" data-insert="Normal pelvic ultrasound. / Siêu âm phụ khoa bình thường.">Normal Pelvic US</button>
                                    <button type="button" class="suggestion-btn" data-insert="Uterine fibroids as described above. / Ghi nhận u xơ tử cung như mô tả ở trên.">Fibroids as Described</button>
                                    <button type="button" class="suggestion-btn" data-insert="Simple [right/left] ovarian cyst, likely physiological. / Nang đơn giản buồng trứng [phải/trái], nghĩ nang chức năng.">Simple Ovarian Cyst</button>
                                     <button type="button" class="suggestion-btn" data-insert="Hemorrhagic cyst in the [right/left] ovary. / Nang xuất huyết buồng trứng [phải/trái].">Hemorrhagic Cyst</button>
                                     <button type="button" class="suggestion-btn" data-insert="Endometrioma in the [right/left] ovary. / Nang lạc nội mạc tử cung buồng trứng [phải/trái].">Endometrioma</button>
                                      <button type="button" class="suggestion-btn" data-insert="Dermoid cyst in the [right/left] ovary. / Nang bì buồng trứng [phải/trái].">Dermoid Cyst</button>
                                    <button type="button" class="suggestion-btn" data-insert="Thickened endometrium ([thickness] mm). Correlation with LMP/clinical history recommended. / Nội mạc tử cung dày ([bề dày] mm). Đề nghị đối chiếu KCC/tiền sử lâm sàng.">Thickened Endometrium</button>
                                    <button type="button" class="suggestion-btn" data-insert="Suspected endometrial polyp. / Nghi ngờ polyp nội mạc tử cung.">Suspected Polyp</button>
                                    <button type="button" class="suggestion-btn" data-insert="Findings suggestive of Polycystic Ovarian Morphology (PCOM). / Hình ảnh gợi ý hình thái buồng trứng đa nang (PCOM).">PCOM Findings</button>
                                    <button type="button" class="suggestion-btn" data-insert="Complex adnexal mass on the [right/left], as described. Further evaluation warranted. / Khối phần phụ phức tạp bên [phải/trái], như mô tả. Cần đánh giá thêm.">Complex Adnexal Mass</button>
                                     <button type="button" class="suggestion-btn" data-insert="Hydrosalpinx, [right/left/bilateral]. / Ứ dịch vòi trứng, [phải/trái/hai bên].">Hydrosalpinx</button>
                                     <button type="button" class="suggestion-btn" data-insert="Small amount of free fluid in the cul-de-sac, may be physiologic. / Ít dịch tự do túi cùng Douglas, có thể là sinh lý.">Physiologic Fluid</button>
                                      <button type="button" class="suggestion-btn" data-insert="IUD appears appropriately positioned. / Vòng tránh thai có vẻ đúng vị trí.">IUD OK</button>
                                      <button type="button" class="suggestion-btn" data-insert="IUD in low position / malpositioned. / Vòng tránh thai vị trí thấp / lệch vị trí.">IUD Malpositioned</button>
                                </div>
                            </div>
                             <div class="form-group">
                                <label for="recommendation">Recommendation / Đề nghị:</label>
                                <textarea id="recommendation" name="recommendation" rows="3" placeholder="e.g., Follow-up scan, Clinical correlation, Saline infusion sonohysterography, Biopsy... / Ví dụ: Tái khám, Đối chiếu LS, Siêu âm bơm nước lòng TC, Sinh thiết..."></textarea>
                                <div class="suggestion-button-container">
                                     <button type="button" class="suggestion-btn" data-insert="Clinical correlation recommended. / Đề nghị đối chiếu lâm sàng.">Clinical Correlation</button>
                                     <button type="button" class="suggestion-btn" data-insert="Follow-up ultrasound in [4-6] weeks to reassess cyst. / Siêu âm kiểm tra lại sau [4-6] tuần để đánh giá lại nang.">Follow-up Cyst</button>
                                     <button type="button" class="suggestion-btn" data-insert="Follow-up ultrasound post-menstruation. / Siêu âm kiểm tra lại sau sạch kinh.">Follow-up Post-Menses</button>
                                     <button type="button" class="suggestion-btn" data-insert="Consider Saline Infusion Sonohysterography (SIS) for further evaluation of endometrium/polyp. / Cân nhắc Siêu âm bơm nước lòng tử cung (SIS) để đánh giá thêm nội mạc/polyp.">Consider SIS</button>
                                     <button type="button" class="suggestion-btn" data-insert="Endometrial biopsy may be considered based on clinical presentation. / Có thể cân nhắc sinh thiết nội mạc tử cung dựa trên bệnh cảnh lâm sàng.">Consider Biopsy</button>
                                     <button type="button" class="suggestion-btn" data-insert="MRI pelvis recommended for further characterization of mass. / Đề nghị MRI tiểu khung để đánh giá rõ hơn khối u.">Recommend MRI</button>
                                     <button type="button" class="suggestion-btn" data-insert="Consider tumor markers (e.g., CA-125) based on findings. / Cân nhắc xét nghiệm dấu ấn khối u (vd: CA-125) dựa trên kết quả.">Consider Tumor Markers</button>
                                     <button type="button" class="suggestion-btn" data-insert="No acute findings. Routine gynecologic follow-up. / Không có dấu hiệu cấp tính. Tái khám phụ khoa định kỳ.">Routine Follow-up</button>
                                </div>
                            </div>
                         </div>
                    </details>

                </form>
            </div>

            <div class="tab-content" id="images">
                 <h2>Ultrasound Images / Hình ảnh Siêu âm</h2>
                <div class="form-group">
                    <label for="image-upload">Upload Images / Tải ảnh lên:</label>
                    <input type="file" id="image-upload" multiple accept="image/*" style="display: block; margin-top: 5px;">
                </div>
                <div id="image-preview-container" style="margin-top: 15px;">
                    </div>
            </div>

            <div class="tab-content" id="templates">
                 <h2>Template Management / Quản lý Mẫu</h2>
                <div class="form-group">
                    <label for="template-name">Template Name / Tên Mẫu:</label>
                    <input type="text" id="template-name" placeholder="Enter name to save / Nhập tên để lưu">
                    <button type="button" id="save-template-btn"><i class="fas fa-save"></i> Save Current as Template / Lưu thành Mẫu</button>
                </div>
                <hr>
                <div class="form-group">
                    <label for="load-template-select">Select Template to Load / Chọn Mẫu để tải:</label>
                    <select id="load-template-select">
                        <option value="">-- Select Template / Chọn Mẫu --</option>
                        <optgroup label="Presets / Mẫu có sẵn" id="preset-templates-group"></optgroup>
                        <optgroup label="My Templates / Mẫu của tôi" id="user-templates-group"></optgroup>
                    </select>
                    <button type="button" id="load-template-btn"><i class="fas fa-download"></i> Load Template / Tải Mẫu</button>
                    <button type="button" id="delete-template-btn" class="danger-btn"><i class="fas fa-trash-alt"></i> Delete Selected Template / Xóa Mẫu</button>
                </div>
                <hr>
                <div class="form-group">
                    <label for="import-template-file">Import Template (JSON) / Nhập Mẫu (JSON):</label>
                    <input type="file" id="import-template-file" accept=".json" style="display: none;"> <button type="button" id="import-template-btn"><i class="fas fa-file-import"></i> Import / Nhập</button>
                </div>
                <div class="form-group">
                    <label>Export Current State / Xuất trạng thái hiện tại:</label>
                    <button type="button" id="export-template-btn"><i class="fas fa-file-export"></i> Export Current State (JSON) / Xuất (JSON)</button>
                </div>
            </div>

            <div class="tab-content" id="report">
                 <h2>Report Preview & Actions / Xem trước & Thao tác Báo cáo</h2>

                <div id="report-preview" class="report-output-area">
                    <p class="placeholder-text"><i>Report preview (EN) will appear here after generation. / Bản xem trước (EN) sẽ hiện ở đây sau khi tạo.</i></p>
                </div>

                <div class="report-section-container" id="translation-section" style="margin-top: 20px; display: none;">
                    <div class="report-header">
                        <h3><i class="fas fa-language"></i> Vietnamese Translation / Bản dịch Tiếng Việt (VI)</h3>
                        <button type="button" id="edit-translation-btn" class="edit-toggle-btn" style="display: none;"><i class="fas fa-edit"></i> Sửa bản dịch</button>
                    </div>
                    <div id="translation-content" class="report-output-area" style="border-top: 1px solid #ddd; border-radius: 0 0 5px 5px; min-height: 100px;">
                        <p class="placeholder-text"><i>Translation (VI) will appear here. / Bản dịch (VI) sẽ hiện ở đây.</i></p>
                    </div>
                    <textarea id="translation-edit-area" class="report-textarea" rows="15" style="display: none; border-radius: 0 0 5px 5px; border-top: 1px solid #ddd; margin-top: -1px;" placeholder="Edit the Markdown translation here... / Chỉnh sửa bản dịch dạng Markdown tại đây..."></textarea>
                </div>

                <div id="translation-loading" style="text-align: center; margin-top: 15px; display: none;">
                    <span class="loading-spinner"></span> Translating report... / Đang dịch báo cáo...
                </div>

                <div class="report-actions">
                    <button type="button" id="generate-report-btn"><i class="fas fa-cogs"></i> Generate Report / Tạo Báo cáo</button>
                    <button type="button" id="translate-report-btn" style="display: none;" class="action-btn-translate"><i class="fas fa-language"></i> Dịch (VI)</button>
                    <button type="button" id="print-report-btn" style="display: none;"><i class="fas fa-print"></i> Print / In (EN)</button>
                    <button type="button" id="print-translation-btn" style="display: none;" class="action-btn-print-vi"><i class="fas fa-print"></i> Print / In (VI)</button>
                    <button type="button" id="export-report-html-btn" style="display: none;"><i class="fas fa-file-export"></i> Export / Xuất (HTML)</button>
                </div>
            </div>

        </div> <div id="notifications"></div> </div> <script type="module" src="js/main.js"></script>

    </body>
</html>